# Next.js useSearchParams 규칙

## useSearchParams() 사용 시 Suspense Boundary 필수

Next.js에서 `useSearchParams()`를 사용하는 컴포넌트는 반드시 Suspense boundary로 감싸야 합니다.
이는 정적 생성(SSG) 및 서버 사이드 렌더링(SSR) 시 발생할 수 있는 오류를 방지하기 위함입니다.

### 규칙 적용 방법:

1. **`useSearchParams()`를 사용하는 컴포넌트를 별도 함수 컴포넌트로 분리**
2. **메인 페이지 컴포넌트에서 Suspense로 감싸기**

### 예시:

```typescript
// ❌ 잘못된 방법
export default function LoginPage() {
  const searchParams = useSearchParams(); // 에러 발생
  // ...
}

// ✅ 올바른 방법
function LoginForm() {
  const searchParams = useSearchParams();
  // ...
}

export default function LoginPage() {
  return (
    <Suspense fallback={<div>로딩 중...</div>}>
      <LoginForm />
    </Suspense>
  );
}
```

### 적용 대상:
- `app/login/page.tsx`
- `app/signup/page.tsx`
- 기타 `useSearchParams()`를 사용하는 모든 페이지 컴포넌트

### 참고:
- Vercel 배포 시 빌드 오류를 방지하기 위해 필수입니다.
- Next.js 공식 문서: https://nextjs.org/docs/messages/missing-suspense-with-csr-bailout

---

# Supabase 데이터베이스 작업 규칙

## 데이터베이스 스키마 변경 시 Supabase MCP 사용 필수

데이터베이스 관련 작업(테이블 생성, 수정, 함수 생성, 인덱스 추가 등)을 수행할 때는 반드시 Supabase MCP 도구를 직접 사용해야 합니다.

### 규칙 적용 방법:

1. **SQL 파일 수정 후 자동 적용하지 않음**
   - `supabase-schema.sql` 등의 SQL 파일을 수정한 후에는 반드시 Supabase MCP를 사용하여 데이터베이스에 적용해야 합니다.
   - SQL 파일만 수정하고 끝내지 말 것.

2. **마이그레이션 사용**
   - `mcp_supabase_apply_migration` 도구를 사용하여 DDL 작업 수행
   - 마이그레이션 이름은 snake_case로 작성 (예: `add_search_files_fulltext_function`)

3. **SQL 실행**
   - 간단한 쿼리나 데이터 조회는 `mcp_supabase_execute_sql` 사용
   - DDL 작업은 `mcp_supabase_apply_migration` 사용 권장

### 예시:

```typescript
// ✅ 올바른 방법: RPC 함수 생성 시
await mcp_supabase_apply_migration({
  name: 'add_search_files_fulltext_function',
  query: `
    CREATE OR REPLACE FUNCTION search_files_fulltext(search_query TEXT)
    RETURNS TABLE (...) AS $$
    BEGIN
      -- 함수 내용
    END;
    $$ LANGUAGE plpgsql STABLE;
  `
});

// ❌ 잘못된 방법: SQL 파일만 수정하고 끝냄
// supabase-schema.sql 파일만 수정하고 사용자에게 "데이터베이스에 적용하세요"라고 말하지 말 것
```

### 적용 대상:
- 테이블 생성/수정/삭제
- 함수 생성/수정/삭제
- 인덱스 생성/삭제
- 트리거 생성/수정/삭제
- RLS 정책 추가/수정/삭제
- 기타 DDL 작업

### 참고:
- Supabase MCP를 사용하면 즉시 데이터베이스에 변경사항이 적용됩니다.
- SQL 파일은 문서화 목적으로 유지하되, 실제 적용은 MCP를 통해 수행합니다.

