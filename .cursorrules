# Next.js useSearchParams 규칙

## useSearchParams() 사용 시 Suspense Boundary 필수

Next.js에서 `useSearchParams()`를 사용하는 컴포넌트는 반드시 Suspense boundary로 감싸야 합니다.
이는 정적 생성(SSG) 및 서버 사이드 렌더링(SSR) 시 발생할 수 있는 오류를 방지하기 위함입니다.

### 규칙 적용 방법:

1. **`useSearchParams()`를 사용하는 컴포넌트를 별도 함수 컴포넌트로 분리**
2. **메인 페이지 컴포넌트에서 Suspense로 감싸기**

### 예시:

```typescript
// ❌ 잘못된 방법
export default function LoginPage() {
  const searchParams = useSearchParams(); // 에러 발생
  // ...
}

// ✅ 올바른 방법
function LoginForm() {
  const searchParams = useSearchParams();
  // ...
}

export default function LoginPage() {
  return (
    <Suspense fallback={<div>로딩 중...</div>}>
      <LoginForm />
    </Suspense>
  );
}
```

### 적용 대상:
- `app/login/page.tsx`
- `app/signup/page.tsx`
- 기타 `useSearchParams()`를 사용하는 모든 페이지 컴포넌트

### 참고:
- Vercel 배포 시 빌드 오류를 방지하기 위해 필수입니다.
- Next.js 공식 문서: https://nextjs.org/docs/messages/missing-suspense-with-csr-bailout

---

# Supabase 데이터베이스 작업 규칙

## 데이터베이스 스키마 변경 시 Supabase MCP 사용 필수

데이터베이스 관련 작업(테이블 생성, 수정, 함수 생성, 인덱스 추가 등)을 수행할 때는 반드시 Supabase MCP 도구를 직접 사용해야 합니다.

### 규칙 적용 방법:

1. **SQL 파일 수정 후 자동 적용하지 않음**
   - `supabase-schema.sql` 등의 SQL 파일을 수정한 후에는 반드시 Supabase MCP를 사용하여 데이터베이스에 적용해야 합니다.
   - SQL 파일만 수정하고 끝내지 말 것.

2. **마이그레이션 사용**
   - `mcp_supabase_apply_migration` 도구를 사용하여 DDL 작업 수행
   - 마이그레이션 이름은 snake_case로 작성 (예: `add_search_files_fulltext_function`)

3. **SQL 실행**
   - 간단한 쿼리나 데이터 조회는 `mcp_supabase_execute_sql` 사용
   - DDL 작업은 `mcp_supabase_apply_migration` 사용 권장

### 예시:

```typescript
// ✅ 올바른 방법: RPC 함수 생성 시
await mcp_supabase_apply_migration({
  name: 'add_search_files_fulltext_function',
  query: `
    CREATE OR REPLACE FUNCTION search_files_fulltext(search_query TEXT)
    RETURNS TABLE (...) AS $$
    BEGIN
      -- 함수 내용
    END;
    $$ LANGUAGE plpgsql STABLE;
  `
});

// ❌ 잘못된 방법: SQL 파일만 수정하고 끝냄
// supabase-schema.sql 파일만 수정하고 사용자에게 "데이터베이스에 적용하세요"라고 말하지 말 것
```

### 적용 대상:
- 테이블 생성/수정/삭제
- 함수 생성/수정/삭제
- 인덱스 생성/삭제
- 트리거 생성/수정/삭제
- RLS 정책 추가/수정/삭제
- 기타 DDL 작업

### 참고:
- Supabase MCP를 사용하면 즉시 데이터베이스에 변경사항이 적용됩니다.
- SQL 파일은 문서화 목적으로 유지하되, 실제 적용은 MCP를 통해 수행합니다.

---

# 개발 문서 최신화 규칙

## 주요 개발 후 개발 문서 업데이트 필수

주요 기능 개발, 아키텍처 변경, 설정 변경 등의 작업을 완료한 후에는 관련 개발 문서를 반드시 최신화해야 합니다.

### 규칙 적용 방법:

1. **주요 개발 완료 시점에 문서 업데이트**
   - 기능 개발 완료 후 즉시 관련 문서 업데이트
   - 코드 변경만 하고 문서 업데이트를 미루지 말 것
   - 문서 업데이트는 기능 구현의 일부로 간주

2. **업데이트 대상 문서 및 업데이트 내용**

   **README.md**
   - 새로 추가된 주요 기능 설명
   - 변경된 기술 스택
   - 새로운 환경 변수
   - 의존성 추가/변경

   **PROJECT_STRUCTURE.md**
   - 새로 추가된 디렉토리/파일 설명
   - 변경된 파일 역할
   - 새로운 API 엔드포인트
   - 변경된 데이터 흐름
   - 새로운 컴포넌트 설명

   **ARCHITECTURE.md**
   - 새로운 시스템의 상세 설계 추가
   - 기존 시스템 설계 변경사항
   - 아키텍처 결정 및 이유
   - 기술 스택 변경사항
   - 파일 구조 변경사항

   **DEVELOPMENT_PLAN.md**
   - 완료된 기능을 "✅ 완료된 기능" 섹션에 추가
   - 진행 중인 작업 상태 업데이트
   - 새로운 이슈 추가
   - 다음 개발 계획 업데이트

   **SETUP_GUIDE.md**
   - 환경 설정 변경사항
   - 새로운 설정 단계 추가

   **supabase-schema.sql**
   - 데이터베이스 스키마 변경사항 반영

3. **업데이트 우선순위**
   - 기능 구현 완료 직후: PROJECT_STRUCTURE.md, DEVELOPMENT_PLAN.md
   - 주요 시스템 설계 변경 시: ARCHITECTURE.md
   - 프로젝트 개요 변경 시: README.md
   - 설정 변경 시: SETUP_GUIDE.md

### 예시:

```markdown
// ✅ 올바른 방법: 기능 개발 후 문서 업데이트
1. 파일 검색 기능 개발 완료
2. PROJECT_STRUCTURE.md에 새로운 API 엔드포인트 추가
3. ARCHITECTURE.md에 검색 시스템 상세 설계 추가 (필요시)
4. README.md에 검색 기능 설명 추가
5. DEVELOPMENT_PLAN.md에 완료 상태 업데이트

// ❌ 잘못된 방법: 코드만 수정하고 문서 업데이트 생략
1. 파일 검색 기능 개발 완료
2. 문서 업데이트는 나중에... (하지 않음)
```

### 적용 대상:
- 새로운 기능 추가
- 기존 기능 수정/개선
- API 엔드포인트 추가/변경
- 데이터베이스 스키마 변경
- 컴포넌트 구조 변경
- 설정 파일 변경
- 의존성 추가/변경
- 아키텍처 변경

### 문서 업데이트 체크리스트:

기능 개발 완료 후 다음을 확인하세요:

- [ ] PROJECT_STRUCTURE.md에 새 파일/디렉토리 설명 추가
- [ ] PROJECT_STRUCTURE.md에 변경된 파일 역할 업데이트
- [ ] ARCHITECTURE.md에 새로운 시스템 설계 추가 (주요 시스템인 경우)
- [ ] DEVELOPMENT_PLAN.md에 완료 상태 업데이트
- [ ] README.md에 주요 기능 설명 추가/업데이트
- [ ] 관련 설정 문서 업데이트 (환경 변수, 의존성 등)

### 참고:
- 문서는 코드와 함께 유지보수되어야 합니다.
- 문서가 최신 상태를 유지해야 새로운 팀원이나 향후 유지보수 시 혼란을 방지할 수 있습니다.
- 문서 업데이트는 커밋 메시지에도 포함하는 것을 권장합니다.
- ARCHITECTURE.md는 주요 시스템의 상세 설계를 포함하므로, 새로운 주요 시스템을 추가하거나 기존 시스템을 크게 변경할 때 반드시 업데이트해야 합니다.

---

# 개발 문서 참고 규칙

## 주요 개발 전 개발 문서 파악 필수

주요 기능 개발, 아키텍처 변경, 설정 변경 등의 작업을 시작하기 전에는 반드시 관련 개발 문서를 먼저 참고하여 현재 상태를 파악해야 합니다.

### 규칙 적용 방법:

1. **개발 시작 전 문서 확인**
   - 기능 개발 시작 전 관련 문서를 먼저 읽고 파악
   - 기존 구조와 규칙을 이해한 후 개발 진행
   - 문서를 읽지 않고 바로 코드 수정하지 말 것

2. **참고 대상 문서 (우선순위 순)**
   - `README.md`: 프로젝트 개요, 설치 방법, 주요 기능, 기술 스택
   - `PROJECT_STRUCTURE.md`: 프로젝트 구조, 디렉토리 구조, 주요 파일 설명, 데이터 흐름
   - `ARCHITECTURE.md`: 주요 시스템 상세 설계 (인증, 이미지 메타데이터, 컴포넌트 아키텍처, AI 이미지 재생성)
   - `DEVELOPMENT_PLAN.md`: 개발 진행 상황, 다음 개발 계획, 현재 이슈
   - `SETUP_GUIDE.md`: 환경 설정 및 초기 설정 방법
   - `supabase-schema.sql`: 데이터베이스 스키마 구조
   - 기타 관련 문서 파일

3. **파악해야 할 내용**
   - 현재 프로젝트 구조 및 아키텍처
   - 기존 기능의 동작 방식
   - 데이터베이스 스키마 구조
   - API 엔드포인트 구조
   - 컴포넌트 사용 패턴
   - 코딩 컨벤션 및 스타일 가이드
   - 권한 및 역할 체계
   - 관련 시스템의 상세 설계 (ARCHITECTURE.md 참고)

### 예시:

```markdown
// ✅ 올바른 방법: 개발 전 문서 파악
1. 파일 검색 기능 개발 요청 받음
2. PROJECT_STRUCTURE.md에서 API 구조 확인
3. ARCHITECTURE.md에서 관련 시스템 설계 확인
4. supabase-schema.sql에서 데이터베이스 스키마 확인
5. DEVELOPMENT_PLAN.md에서 현재 진행 상황 확인
6. 기존 구조 파악 후 개발 시작

// ❌ 잘못된 방법: 문서 확인 없이 바로 개발
1. 파일 검색 기능 개발 요청 받음
2. 바로 코드 수정 시작 (문서 확인 안 함)
3. 기존 구조와 맞지 않는 코드 작성
```

### 적용 대상:
- 새로운 기능 추가
- 기존 기능 수정/개선
- API 엔드포인트 추가/변경
- 데이터베이스 스키마 변경
- 컴포넌트 구조 변경
- 설정 파일 변경
- 아키텍처 변경

### 참고:
- 문서를 먼저 파악하면 기존 구조와 일관성 있는 코드를 작성할 수 있습니다.
- 문서 확인을 통해 중복 개발이나 잘못된 방향으로의 개발을 방지할 수 있습니다.
- 문서가 없거나 부족한 경우, 코드베이스를 탐색하여 구조를 파악한 후 개발을 진행합니다.
- ARCHITECTURE.md는 주요 시스템의 상세 설계를 포함하므로 관련 기능 개발 시 반드시 참고해야 합니다.

